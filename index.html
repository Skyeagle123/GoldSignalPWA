<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>إشارات الذهب • GoldSignals</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />
  <style>
    :root{--bg:#0b1220;--card:#111827;--muted:#9ca3af;--line:#1f2937;--text:#e5e7eb;--good:#10b981;--bad:#ef4444;--warn:#f59e0b}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    header{position:sticky;top:0;z-index:5;background:rgba(11,18,32,.9);backdrop-filter:blur(6px);border-bottom:1px solid var(--line)}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:20px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 8px 22px rgba(0,0,0,.25)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 220px}
    label{display:block;margin:0 0 6px;color:var(--muted);font-size:13px}
    input,button,select{width:100%;padding:10px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:var(--text)}
    button{cursor:pointer;font-weight:600}
    .btns .btn{flex:1 1 120px}
    .btn-tabs{display:flex;gap:8px;flex-wrap:wrap}
    .btn-tab{flex:1 1 120px;border:1px solid #334155;background:#0b1220;border-radius:999px;padding:8px 10px;text-align:center;cursor:pointer}
    .btn-tab.active{border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.25) inset}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid #334155;background:#0b1220;font-size:12px}
    .good{color:var(--good)} .bad{color:var(--bad)} .warn{color:var(--warn)}
    table{width:100%;border-collapse:collapse;direction:rtl}
    th,td{border-bottom:1px solid #273449;padding:10px 8px;text-align:right}
    th{color:#b6c2d3;font-weight:600}
    .kpi{font-size:28px;font-weight:700}
    .pivot-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}
    .pv{background:#0b1220;border:1px solid #334155;border-radius:12px;padding:10px;text-align:center}
    .pv h4{margin:0 0 6px;color:#9fb3c8;font-weight:600}
    .pv .v{font-size:18px}
    .muted{color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <header><div class="wrap"><h1>GoldSignals • إشارات الذهب</h1></div></header>

  <div class="wrap">
    <!-- الإعدادات -->
    <div class="card">
      <div class="grid">
        <div>
          <label>رابط CSV للأسعار (اختياري):</label>
          <input id="csvUrl" placeholder="اتركه فارغًا لاستخدام ملف 5 دقائق الافتراضي" />
          <div class="muted" style="margin-top:6px">إذا تركته فارغًا سيُقرأ من <code>XAUUSD_5min.csv</code> من الريبو تلقائيًا.</div>
        </div>

        <div>
          <label>إطار زمني:</label>
          <div class="btn-tabs" id="tfTabs">
            <div data-tf="m5" class="btn-tab active">٥ دقائق</div>
            <div data-tf="h1" class="btn-tab">ساعة</div>
            <div data-tf="d1" class="btn-tab">يوم</div>
          </div>
        </div>

        <div>
          <label>إعدادات المؤشرات:</label>
          <div class="row">
            <div class="col"><input id="emaFast" type="number" value="12"><label>EMA سريع</label></div>
            <div class="col"><input id="emaSlow" type="number" value="26"><label>EMA بطيء</label></div>
            <div class="col"><input id="rsiPeriod" type="number" value="14"><label>RSI فترة</label></div>
          </div>
        </div>
      </div>

      <div class="row btns" style="margin-top:12px">
        <button class="btn" id="runBtn">حساب الإشارات الآن</button>
      </div>
      <div class="muted" style="margin-top:6px">يحدث نفسه كل 60 ثانية ويلتقط آخر صف من ملف الـCSV.</div>
    </div>

    <!-- السعر الحي -->
    <div class="card">
      <div class="grid">
        <div>
          <label>السعر الحي</label>
          <div class="kpi" id="livePrice">—</div>
          <div class="muted" style="margin-top:6px">آخر تحديث: <span id="liveTs">—</span></div>
          <div class="muted" style="margin-top:6px">الملخّص: <span id="signalNow" class="good">—</span></div>
        </div>
        <div>
          <label>Pivot يُحسب من آخر يوم مكتمل (High/Low/Close)</label>
          <div class="pivot-grid" style="margin-top:6px">
            <div class="pv"><h4>R3</h4><div class="v" id="r3">—</div></div>
            <div class="pv"><h4>R2</h4><div class="v" id="r2">—</div></div>
            <div class="pv"><h4>R1</h4><div class="v" id="r1">—</div></div>
            <div class="pv"><h4>Pivot</h4><div class="v" id="pp">—</div></div>
            <div class="pv"><h4>S1</h4><div class="v" id="s1">—</div></div>
            <div class="pv"><h4>S2</h4><div class="v" id="s2">—</div></div>
            <div class="pv"><h4>S3</h4><div class="v" id="s3">—</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- البيانات الأخيرة -->
    <div class="card">
      <h3 style="margin-top:0">البيانات الأخيرة</h3>
      <div style="overflow:auto">
        <table id="recentTable">
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>الوقت</th>
              <th>السعر</th>
              <th>الإشارة</th>
              <th>RSI</th>
              <th>MACD</th>
              <th>EMA F</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <p class="muted">* هذه الإشارات تعليمية وليست توصية استثمارية.</p>
  </div>

  <script src="app.js"></script>
</body>
</html>
